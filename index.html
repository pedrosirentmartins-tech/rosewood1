<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rosewood Medical Center</title>
<style>
:root{--accent:#ff2b9e;}
body{font-family:Arial;margin:0;background:#fff;}
header{display:flex;align-items:center;gap:15px;padding:20px;border-bottom:1px solid #ddd;}
header img{height:80px;}
.wrap{max-width:1100px;margin:auto;padding:20px;}
.grid{display:grid;grid-template-columns:1fr 420px;gap:20px;}
.panel{background:#fff;padding:20px;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,.08);} 
label{display:block;margin-top:10px;font-weight:bold;}
input,select,textarea{width:100%;padding:10px;margin-top:4px;border:1px solid #ccc;border-radius:8px;}
.row{display:flex;gap:10px;flex-wrap:wrap;}
.row>div{flex:1;min-width:120px;}  
button{background:var(--accent);color:#fff;border:none;padding:10px 16px;margin-top:15px;border-radius:8px;cursor:pointer;}
.cards{display:grid;gap:12px;margin-top:10px;}
.card{display:flex;gap:10px;padding:10px;border:1px solid #f2c;border-radius:10px;}
.card img{width:70px;height:70px;object-fit:cover;border-radius:8px;}
@media(max-width:900px){.grid{grid-template-columns:1fr;}}
</style>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
<header>
<img src="https://i.imgur.com/wv6Uhnk.png">
<h1>Rosewood Medical Center</h1>
</header>
<div class="wrap">
<div class="grid">
<div class="panel">
<h2>Novo cadastro</h2>
<form id="form">
<label>Nome</label><input id="nome" required>
<label>CPF (sem limite)</label><input id="cpf">
<div class="row">
<div><label>Idade</label><input type="number" id="idade"></div>
<div><label>Altura</label><input id="altura"></div>
<div><label>Tipo Sanguíneo</label><select id="sangue">
<option></option>
<option>A+</option>
<option>A-</option>
<option>B+</option>
<option>B-</option>
</select></div>
</div>
<label>Observações</label><textarea id="obs"></textarea>
<label>Foto</label><input type="file" id="foto" accept="image/*">
<button id="salvarBtn" type="submit">Salvar</button> <button type="button" id="cancelarEdit" style="display:none;background:#999">Cancelar edição</button> <button type="button" id="apagarTudo" style="background:#ccc;color:#000">Apagar todos</button>
</form>
</div>
<div class="panel">
<h2>Banco de dados</h2>
<input id="buscar" placeholder="Buscar por nome ou CPF" onkeyup="render()" style="margin-bottom:10px;width:100%;padding:8px;border-radius:8px;border:1px solid #ccc">
<button type="button" onclick="exportarExcel()">Exportar Excel</button>
<div id="cards" class="cards"></div>
</div>
</div>
</div>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script>
// ===== FIREBASE CONFIG =====
const firebaseConfig = {apiKey: "AIzaSyBRFlVvCNQRj9QEQcfcTPWJVletd34vu2g",authDomain: "rosewood-a17a5.firebaseapp.com",databaseURL: "https://rosewood-a17a5-default-rtdb.firebaseio.com",projectId: "rosewood-a17a5",storageBucket: "rosewood-a17a5.firebasestorage.app",messagingSenderId: "20548352872",appId: "1:20548352872:web:c62d40e9dea3efbb80b4dd"};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

// ===== ADMIN LIST =====
const ADMINS = ["admin@rosewood.com"];
let usuario = null;

// ===== LOGIN UI =====
document.body.insertAdjacentHTML("afterbegin",`
<div id='loginBox' style="position:fixed;inset:0;background:#fff;display:flex;align-items:center;justify-content:center;z-index:999">
  <div style='width:320px;padding:20px;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,.1)'>
    <h3>Login</h3>
    <input id='loginEmail' placeholder='Email' style='width:100%;margin-bottom:8px;padding:8px'>
    <input id='loginSenha' type='password' placeholder='Senha' style='width:100%;margin-bottom:8px;padding:8px'>
    <button onclick='entrar()' style='width:100%'>Entrar</button>
    <button onclick='registrar()' style='width:100%;background:#666'>Registrar</button>
    <div id='msgLogin' style='margin-top:8px;color:red'></div>
  </div>
</div>`);

function entrar(){
 let e=loginEmail.value, s=loginSenha.value;
 auth.signInWithEmailAndPassword(e,s).catch(x=>msgLogin.innerText=x.message);
}
function registrar(){
 let e=loginEmail.value, s=loginSenha.value;
 auth.createUserWithEmailAndPassword(e,s).catch(x=>msgLogin.innerText=x.message);
}

// ===== PERMISSIONS =====
auth.onAuthStateChanged(u=>{
 if(!u) return;
 usuario = u;
 document.getElementById('loginBox').remove();
 aplicarPermissoes();
 render();
});

function aplicarPermissoes(){
 let admin = ADMINS.includes(usuario.email);
 document.getElementById('form').style.display = admin?'block':'none';
 document.getElementById('apagarTudo').style.display = admin?'inline-block':'none';
}

// ===== RENDER =====
function render(){
 let q = (buscar?.value||"").toLowerCase();
 let area = cards; area.innerHTML='';
 db.ref('cadastros').on('value',snap=>{
  let dados = snap.val()||{};
  Object.values(dados).filter(p=>(p.nome||"").toLowerCase().includes(q)||(p.cpf||"").toLowerCase().includes(q)).forEach(p=>{
   let admin = ADMINS.includes(usuario.email);
   let c=document.createElement('div'); c.className='card';
   c.innerHTML=`${p.foto?`<img src='${p.foto}'>`:''}<div style='flex:1'><b>${p.nome}</b><br>CPF:${p.cpf}<br>Idade:${p.idade}<br>Altura:${p.altura}<br>Sangue:${p.sangue}${p.obs?`<div>${p.obs}</div>`:''}${admin?`<div><button onclick="editar('${p.id}')">Editar</button><button onclick="apagar('${p.id}')" style="background:#f44">Apagar</button></div>`:''}</div>`;
   area.appendChild(c);
  });
 });
}

// ===== CRUD =====
form.onsubmit=e=>{e.preventDefault();let id=editarId||Date.now().toString();let file=foto.files[0];let r=new FileReader();function salvar(img){db.ref('cadastros/'+id).set({id,nome:nome.value,cpf:cpf.value,idade:idade.value,altura:altura.value,sangue:sangue.value,obs:obs.value,foto:img});form.reset();editarId=null;salvarBtn.innerText='Salvar';}
 if(file){r.onload=()=>salvar(r.result);r.readAsDataURL(file);} else salvar('');}

function editar(id){db.ref('cadastros/'+id).once('value',s=>{let p=s.val();nome.value=p.nome;cpf.value=p.cpf;idade.value=p.idade;altura.value=p.altura;sangue.value=p.sangue;obs.value=p.obs;editarId=id;salvarBtn.innerText='Salvar alteração';})}
function apagar(id){db.ref('cadastros/'+id).remove()}

apagarTudo.onclick=()=>{if(confirm('Apagar tudo?'))db.ref('cadastros').remove()}
buscar.onkeyup=render;

function exportarExcel(){let t='<table border=1><tr><th>Nome</th><th>CPF</th><th>Idade</th><th>Altura</th><th>Sangue</th><th>Obs</th></tr>';db.ref('cadastros').once('value',s=>{Object.values(s.val()||{}).forEach(p=>{t+=`<tr><td>${p.nome||''}</td><td>${p.cpf||''}</td><td>${p.idade||''}</td><td>${p.altura||''}</td><td>${p.sangue||''}</td><td>${p.obs||''}</td></tr>`});let a=document.createElement('a');a.href='data:application/vnd.ms-excel,'+encodeURIComponent(t);a.download='backup.xls';a.click();})}
</script>
</body></html>
